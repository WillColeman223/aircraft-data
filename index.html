<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FlightBank</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }

    h2, p {
      margin: 10px;
    }

    ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
      background-color: #8B0000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1;
    }

    ul li a {
      display: block;
      color: white;
      padding: 14px 16px;
      text-decoration: none;
    }

    ul li a:hover {
      background-color: #111111;
    }

    .menu-items {
      display: flex;
      gap: 0;
    }

    #searchBar {
      padding: 8px 12px; 
      font-size: 14px;
      border-radius: 5px;
      border: 2px solid #600000;
      margin-right: 0px;
      background-color: #A00000;
      color: white;
    }

    #searchBar::placeholder {
      color: #ddd;
    }

    h1, h2 { text-align: center; }

    #stats {
      display: flex;
      justify-content: left;
      gap: 30px;
      margin-bottom: 20px;
      margin-left: 20px;
    }

    
    

    #searchBar {
      width: 300px;
      padding: 15px;
      font-size: 16px;
      border-radius: 1px;
      border: 3px solid #ccc;
      display: block;
      margin-left: 5px;
      margin-bottom: 0px;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      max-height: 70vh;
      overflow-y: auto;
      padding: 10px;
    }

    .card {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      padding: 15px;
      text-align: center;
      transition: transform 0.2s;
    }

    .card:hover { transform: scale(1.03); }

    .card h2 { margin: 0 0 10px 0; font-size: 18px; }
    .card p { margin: 5px 0; font-size: 14px; }
    .card a {
      display: inline-block;
      margin-top: 10px;
      padding: 5px 10px;
      background-color: #2196F3;
      color: white;
      border-radius: 5px;
      text-decoration: none;
      font-size: 14px;
    }
    .card a:hover { background-color: #1976D2; }
  </style>
</head>
<body>
<ul>
  <div class="menu-items">
    <li><a href="https://willcoleman223.github.io/aircraft-data/index.html">FlightBank</a></li>
    <li><a href="https://willcoleman223.github.io/aircraft-data/stats.html">Statistics</a></li>
    <li><a href="#contact">About</a></li>
    <li><a href="#about">Contribute</a></li>
  </div>
  <li><input type="text" id="searchBar" placeholder="Search by Callsign..." /></li>
</ul>

<h1>FlightBank</h1>

<div id="stats">
  <div id="addedAllTime">Planes added all time: 0</div>
</div>

<div id="grid"></div>

<script>
// ICAO Callsign Prefix â†’ Airline Name
const ICAO_AIRLINES = {
  // UK + Europe
  "EZY": "easyJet",
  "EJU": "easyJet Europe",
  "BAW": "British Airways",
  "SHT": "BA Shuttle",
  "RYR": "Ryanair",
  "EIN": "Aer Lingus",
  "TOM": "TUI Airways UK",
  "TUI": "TUI Airlines Belgium",
  "EXS": "Jet2",
  "WUK": "Wizz Air UK",
  "WZZ": "Wizz Air",
  "KLM": "KLM",
  "AFR": "Air France",
  "DLH": "Lufthansa",
  "SWR": "Swiss",
  "BEL": "Brussels Airlines",
  "TAP": "TAP Air Portugal",
  "AZA": "ITA Airways",
  "VLG": "Vueling",
  "VOE": "Volotea",
  "LOT": "LOT Polish Airlines",
  "AUA": "Austrian Airlines",
  "NAX": "Norwegian Air Shuttle",
  "IBK": "Norwegian Air Intl.",
  "SAS": "Scandinavian Airlines",
  "VIR": "Virgin Atlantic",
  "RCH": "US AIRFORCE",
  "SVA": "Saudi Arabian Airlines",

  // US
  "AAL": "American Airlines",
  "UAL": "United Airlines",
  "DAL": "Delta Air Lines",
  "SWA": "Southwest",
  "JBU": "JetBlue",
  "ASA": "Alaska Airlines",
  "FFT": "Frontier Airlines",

  // Cargo
  "FDX": "FedEx",
  "UPS": "UPS",
  "BCS": "DHL",
  "GTI": "Atlas Air",
  "CLX": "Cargolux",

  // Middle East
  "UAE": "Emirates",
  "ETD": "Etihad",
  "QTR": "Qatar Airways",

  // Asia
  "JAL": "Japan Airlines",
  "ANA": "All Nippon Airways",
  "SIA": "Singapore Airlines",
  "THA": "Thai Airways",
  "CCA": "Air China",
  "CES": "China Eastern",
  "CSN": "China Southern",
  "EVA": "EVA Air",

  // Canada
  "ACA": "Air Canada",
  "WJA": "WestJet"
};

const FIREBASE_URL = "https://flightbank-31a09-default-rtdb.firebaseio.com/PlaneData.json";
let allPlanes = [];
let displayedCount = 0;
const BATCH_SIZE = 30; // render 30 planes at a time

async function fetchPlanes() {
  try {
    const response = await fetch(FIREBASE_URL);
    const data = await response.json();
    const grid = document.getElementById("grid");
    grid.innerHTML = "";
    if (!data) return;

    allPlanes = Object.values(data).sort((a,b) => new Date(b.LastSeen) - new Date(a.LastSeen));
    displayedCount = 0;

    document.getElementById("addedAllTime").textContent = ` `;

    renderNextBatch();
  } catch (err) {
    console.error("Error fetching plane data:", err);
  }
}

function renderNextBatch() {
  const grid = document.getElementById("grid");
  const searchTerm = document.getElementById("searchBar").value.toLowerCase();

  let rendered = 0;
  while (displayedCount < allPlanes.length && rendered < BATCH_SIZE) {
    const plane = allPlanes[displayedCount];
    const prefix = plane.Callsign ? plane.Callsign.substring(0, 3).toUpperCase() : "";
    const airline = ICAO_AIRLINES[prefix] || "Unknown Airline";

    displayedCount++;

    if (!plane.Callsign || (searchTerm && !plane.Callsign.toLowerCase().includes(searchTerm))) continue;

    const card = document.createElement("div");
    card.className = "card";
    card.dataset.callsign = plane.Callsign.toLowerCase();
    card.innerHTML = `
      <h2>${plane.Callsign}</h2>
      <p><strong>Hex:</strong> ${plane.Hex}</p>
      <p><strong>Airline:</strong> ${airline}</p>
      <p><strong>First Updated:</strong> ${plane.FirstSeen}</p>
      <p><strong>Last Updated:</strong> ${plane.LastSeen}</p>
      <a href="https://www.airnavradar.com/data/flights/${plane.Callsign}" target="_blank">View Flight</a>
   
      `;

    grid.appendChild(card);
    rendered++;
  }
}

// infinite scroll
document.getElementById("grid").addEventListener("scroll", () => {
  const grid = document.getElementById("grid");
  if (grid.scrollTop + grid.clientHeight >= grid.scrollHeight - 20) {
    renderNextBatch();
  }
});

// search filter
document.getElementById("searchBar").addEventListener("input", () => {
  displayedCount = 0;
  document.getElementById("grid").innerHTML = "";
  renderNextBatch();
});

// initial fetch + auto-refresh
fetchPlanes();
setInterval(fetchPlanes, 30000); // refresh every 30 seconds
</script>

</body>
</html>

