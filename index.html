<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FlightBank</title>
  <style>
    body {
  margin: 0;
  padding: 0;
}

h2, p {
  margin: 10px;
}

ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
  background-color: #8B0000;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1;
}

ul li a {
  display: block;
  color: white;
  padding: 14px 16px;
  text-decoration: none;
}

ul li a:hover {
  background-color: #111111;
}
.menu-items {
  display: flex;
  gap: 0;
}
#searchBar {
  padding: 8px 12px;
  font-size: 14px;
  border-radius: 5px;
  border: 1px solid #600000;
  margin-right: 15px;
  background-color: #A00000;
  color: white;
}
#searchBar::placeholder {
  color: #ddd;
}
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    h1, h2 { text-align: center; }
    #stats {
      display: flex;
      justify-content: left;
      gap: 30px;
      margin-bottom: 20px;
    }
    #stats div {
      background: #2196F3;
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      font-size: 18px;
    }
    #searchBar {
      width: 300px;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      max-height: 70vh;
      overflow-y: scroll;
      padding: 10px;
    }
    .card {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      padding: 15px;
      text-align: center;
      transition: transform 0.2s;
    }
    .card:hover { transform: scale(1.03); }
    .card h2 { margin: 0 0 10px 0; font-size: 18px; }
    .card p { margin: 5px 0; font-size: 14px; }
    .card a {
      display: inline-block;
      margin-top: 10px;
      padding: 5px 10px;
      background-color: #2196F3;
      color: white;
      border-radius: 5px;
      text-decoration: none;
      font-size: 14px;
    }
    .card a:hover { background-color: #1976D2; }
  </style>
</head>
<body>
<ul>
  <div class="menu-items">
    <li><a href="#home">FlightBank</a></li>
    <li><a href="#news">News</a></li>
    <li><a href="#contact">Contact</a></li>
    <li><a href="#about">About</a></li>
  </div>
  <li><input type="text" id="searchBar" placeholder="Search by Callsign..." /></li>
</ul>

<h1>FlightBank</h1>

<div id="stats">
  <div id="addedAllTime">Planes added all time: 0</div>
</div>

<div id="grid"></div>

<script>
  const FIREBASE_URL = "https://flightbank-31a09-default-rtdb.firebaseio.com/PlaneData.json";

  async function fetchPlanes() {
    try {
      const response = await fetch(FIREBASE_URL);
      const data = await response.json();
      const grid = document.getElementById("grid");
      grid.innerHTML = "";

      if (!data) return;

      // Sort by LastSeen descending
      let planes = Object.values(data).sort((a,b) => new Date(b.LastSeen) - new Date(a.LastSeen));

      // Only show 20 latest planes
      planes = planes.slice(0, 20);

      const today = new Date().toISOString().slice(0,10);
      let addedTodayCount = 0;
      let addedAllTimeCount = Object.keys(data).length;

      planes.forEach(plane => {
        if (plane.FirstSeen && plane.FirstSeen.startsWith(today)) addedTodayCount++;

        const card = document.createElement("div");
        card.className = "card";
        card.dataset.callsign = plane.Callsign.toLowerCase();

        // AirNav link (flight page)
        const airNavLink = `https://www.airnavradar.com/flight/${plane.Callsign}`;

        card.innerHTML = `
          <h2>${plane.Callsign}</h2>
          <p><strong>Hex:</strong> ${plane.Hex}</p>
          <p><strong>First Seen:</strong> ${plane.FirstSeen}</p>
          <p><strong>Last Seen:</strong> ${plane.LastSeen}</p>
          <a href="${airNavLink}" target="_blank">View Flight</a>
        `;
        grid.appendChild(card);
      });

      document.getElementById("addedAllTime").textContent = `Planes added all time: ${addedAllTimeCount}`;

    } catch (err) {
      console.error("Error fetching plane data:", err);
    }
  }

  // Search bar filter
  const searchInput = document.getElementById("searchBar");
  searchInput.addEventListener("input", () => {
    const searchTerm = searchInput.value.toLowerCase();
    document.querySelectorAll(".card").forEach(card => {
      card.style.display = card.dataset.callsign.includes(searchTerm) ? "" : "none";
    });
  });

  // Initial fetch + auto-refresh
  fetchPlanes();
  setInterval(fetchPlanes, 30000); // refresh every 30 seconds
</script>

</body>
</html>
